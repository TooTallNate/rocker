#!/bin/sh
# Whitelist this program in the `/etc/sudoers` file in order
# to make binding to ports < 1024 work without a password:
# https://unix.stackexchange.com/a/90605/102771
set -euo pipefail

hostname="${1}"
shift

control_socket_dir="$HOME/.ssh/rocker_connections"
control_socket="${control_socket_dir}/%C.sock"

ssh -N \
  -S "${control_socket}" \
  -L "${1}" \
  "${hostname}" </dev/tty >/dev/null >/dev/null
